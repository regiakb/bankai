{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}BANKAI - Network Inventory{% endblock %}</title>
    
    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="{% static 'images/favicon.ico' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'images/favicon-16x16.png' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'images/favicon-32x32.png' %}">
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'images/apple-touch-icon.png' %}">
    <link rel="icon" type="image/png" sizes="192x192" href="{% static 'images/android-chrome-192x192.png' %}">
    <link rel="icon" type="image/png" sizes="512x512" href="{% static 'images/android-chrome-512x512.png' %}">
    
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    {% if '/users' in request.path or '/settings' in request.path or '/setup' in request.path or '/integrations' in request.path %}
    <link rel="stylesheet" href="{% static 'css/admin_panel.css' %}">
    {% endif %}
    {% block extra_css %}{% endblock %}
</head>
<body>
    <div class="container">
        <header>
            <a href="{% url 'dashboard' %}">
                <img src="{% static 'images/logo.png' %}" alt="BANKAI">
            </a>
            <button class="mobile-menu-toggle" onclick="toggleMobileMenu()" aria-label="Toggle menu">â˜°</button>
            <nav id="main-nav">
                <a href="{% url 'dashboard' %}" {% if request.resolver_match.url_name == 'dashboard' %}class="active"{% endif %}>Dashboard</a>
                <a href="{% url 'hosts' %}" {% if request.resolver_match.url_name == 'hosts' or request.resolver_match.url_name == 'connection_history' %}class="active"{% endif %}>Hosts</a>
                <a href="{% url 'alerts' %}" {% if request.resolver_match.url_name == 'alerts' %}class="active"{% endif %}>Alerts</a>
                <a href="{% url 'tasks' %}" {% if request.resolver_match.url_name == 'tasks' %}class="active"{% endif %}>Tasks</a>
                {% if user.is_authenticated %}
                <a href="{% url 'settings_index' %}" {% if request.resolver_match.url_name == 'settings_index' or request.resolver_match.url_name == 'setup_wizard' or request.resolver_match.url_name == 'integrations_list' or request.resolver_match.url_name == 'integration_edit' or request.resolver_match.url_name == 'integration_add' or request.resolver_match.url_name == 'integration_delete' or request.resolver_match.url_name == 'users_list' or request.resolver_match.url_name == 'user_detail' or request.resolver_match.url_name == 'user_create' %}class="active"{% endif %}>Settings</a>
                    <form method="post" action="{% url 'logout' %}" style="display: inline;">
                        {% csrf_token %}
                        <button type="submit" style="background: none; border: none; color: #ff6b6b; cursor: pointer; font-size: inherit; font-family: inherit; padding: 0; text-decoration: none;">Logout</button>
                    </form>
                {% endif %}
            </nav>
        </header>

        <main>
            <h2>{% block page_title %}{% endblock %}</h2>
            
            {% if messages %}
                {% for message in messages %}
                    <div class="message message-{{ message.tags }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}

            <div class="content-wrapper">
                {% block content %}{% endblock %}
            </div>
        </main>
    </div>

    <!-- Global modal (confirm & alert) -->
    <div id="appModal" class="app-modal" role="dialog" aria-modal="true" aria-labelledby="appModalTitle" aria-hidden="true">
        <div class="app-modal-backdrop"></div>
        <div class="app-modal-box">
            <h3 id="appModalTitle" class="app-modal-title"></h3>
            <p id="appModalMessage" class="app-modal-message"></p>
            <div class="app-modal-actions">
                <button type="button" id="appModalCancel" class="app-modal-btn app-modal-btn-secondary">Cancel</button>
                <button type="button" id="appModalConfirm" class="app-modal-btn app-modal-btn-primary">Confirm</button>
                <button type="button" id="appModalOk" class="app-modal-btn app-modal-btn-primary" style="display: none;">OK</button>
            </div>
        </div>
    </div>

    {% block extra_js %}{% endblock %}
    <script>
        (function() {
            var modal = document.getElementById('appModal');
            var titleEl = document.getElementById('appModalTitle');
            var messageEl = document.getElementById('appModalMessage');
            var cancelBtn = document.getElementById('appModalCancel');
            var confirmBtn = document.getElementById('appModalConfirm');
            var okBtn = document.getElementById('appModalOk');
            var backdrop = modal && modal.querySelector('.app-modal-backdrop');

            function closeModal() {
                if (modal) {
                    modal.classList.remove('app-modal-open');
                    modal.setAttribute('aria-hidden', 'true');
                }
            }

            window.showConfirmModal = function(options) {
                if (!modal) return;
                var title = options.title || 'Confirm';
                var message = options.message || '';
                var onConfirm = options.onConfirm || function() {};
                var confirmLabel = options.confirmLabel || 'Confirm';
                var cancelLabel = options.cancelLabel || 'Cancel';
                var danger = options.danger !== false;

                titleEl.textContent = title;
                messageEl.textContent = message;
                cancelBtn.textContent = cancelLabel;
                confirmBtn.textContent = confirmLabel;
                cancelBtn.style.display = '';
                confirmBtn.style.display = '';
                okBtn.style.display = 'none';
                confirmBtn.className = 'app-modal-btn app-modal-btn-primary' + (danger ? ' app-modal-btn-danger' : '');

                cancelBtn.onclick = function() { closeModal(); };
                confirmBtn.onclick = function() { closeModal(); onConfirm(); };
                backdrop.onclick = closeModal;
                modal.classList.add('app-modal-open');
                modal.setAttribute('aria-hidden', 'false');
            };

            window.showAlertModal = function(options) {
                if (!modal) return;
                var title = options.title || 'Notice';
                var message = options.message || '';

                titleEl.textContent = title;
                messageEl.textContent = message;
                cancelBtn.style.display = 'none';
                confirmBtn.style.display = 'none';
                okBtn.style.display = '';
                okBtn.onclick = function() { closeModal(); };
                backdrop.onclick = closeModal;
                modal.classList.add('app-modal-open');
                modal.setAttribute('aria-hidden', 'false');
            };

            if (backdrop) backdrop.addEventListener('click', closeModal);
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && modal && modal.classList.contains('app-modal-open')) closeModal();
            });
        })();

        function toggleMobileMenu() {
            const nav = document.getElementById('main-nav');
            nav.classList.toggle('active');
        }
        
        // Close menu when clicking outside
        document.addEventListener('click', function(event) {
            const nav = document.getElementById('main-nav');
            const toggle = document.querySelector('.mobile-menu-toggle');
            if (nav.classList.contains('active') && 
                !nav.contains(event.target) && 
                !toggle.contains(event.target)) {
                nav.classList.remove('active');
            }
        });
    </script>
</body>
</html>
