{% extends 'base.html' %}
{% load static %}
{% load tz %}

{% block title %}Admin Panel - BANKAI{% endblock %}

{% block page_title %}Admin Panel{% endblock %}

{% block content %}
<div class="admin-dashboard">
    <div class="admin-stats-grid">
        <div class="admin-stat-card">
            <div class="stat-icon">‚ö†Ô∏è</div>
            <div class="stat-content">
                <div class="stat-value">{{ alerts_count }}</div>
                <div class="stat-label">Alerts</div>
            </div>
            <a href="{% url 'admin_alerts' %}" class="stat-link">View all ‚Üí</a>
        </div>
        
        <div class="admin-stat-card">
            <div class="stat-icon">üñ•Ô∏è</div>
            <div class="stat-content">
                <div class="stat-value">{{ hosts_count }}</div>
                <div class="stat-label">Hosts ({{ active_hosts_count }} active)</div>
            </div>
            <a href="{% url 'admin_hosts' %}" class="stat-link">View all ‚Üí</a>
        </div>
        
        <div class="admin-stat-card">
            <div class="stat-icon">üîå</div>
            <div class="stat-content">
                <div class="stat-value">{{ enabled_integrations_count }}/{{ integrations_count }}</div>
                <div class="stat-label">Integrations</div>
            </div>
            <a href="{% url 'admin_integrations' %}" class="stat-link">Configure ‚Üí</a>
        </div>
        
        <div class="admin-stat-card">
            <div class="stat-icon">‚öôÔ∏è</div>
            <div class="stat-content">
                <div class="stat-value">{{ task_executions_count }}</div>
                <div class="stat-label">Task Executions</div>
            </div>
            <a href="{% url 'admin_task_executions' %}" class="stat-link">View all ‚Üí</a>
        </div>
        
        <div class="admin-stat-card">
            <div class="stat-icon">üë•</div>
            <div class="stat-content">
                <div class="stat-value">{{ users_count }}</div>
                <div class="stat-label">Users</div>
            </div>
            <a href="{% url 'admin_users' %}" class="stat-link">Manage ‚Üí</a>
        </div>
        
        <div class="admin-stat-card">
            <div class="stat-icon">‚öôÔ∏è</div>
            <div class="stat-content">
                <div class="stat-value">Config</div>
                <div class="stat-label">Configurations</div>
            </div>
            <a href="{% url 'admin_configurations' %}" class="stat-link">Configure ‚Üí</a>
        </div>
    </div>
    
    <div class="admin-sections-grid">
        <div class="admin-section-card">
            <h3>Recent Alerts</h3>
            <div class="admin-list">
                {% for alert in recent_alerts %}
                <div class="admin-list-item">
                    <div class="list-item-main">
                        <span class="badge badge-{% if alert.type == 'new_ip' %}success{% elif alert.type == 'new_service' %}info{% elif alert.type == 'error' %}danger{% elif alert.type == 'task_completed' %}info{% else %}warning{% endif %}">
                            {{ alert.get_type_display }}
                        </span>
                        <span class="list-item-text">{{ alert.message|truncatewords:10 }}</span>
                    </div>
                    <div class="list-item-meta">
                        {% timezone "Europe/Madrid" %}{{ alert.created_at|date:"H:i" }}{% endtimezone %}
                    </div>
                </div>
                {% empty %}
                <div class="admin-list-item">
                    <span class="list-item-text" style="color: #b0b0b0;">No recent alerts</span>
                </div>
                {% endfor %}
            </div>
            <a href="{% url 'admin_alerts' %}" class="section-link">View all alerts ‚Üí</a>
        </div>
        
        <div class="admin-section-card">
            <h3>Latest Executions</h3>
            <div class="admin-list">
                {% for task in recent_tasks %}
                <div class="admin-list-item">
                    <div class="list-item-main">
                        <span class="badge badge-{% if task.status == 'success' %}success{% elif task.status == 'error' %}danger{% else %}warning{% endif %}">
                            {{ task.get_status_display }}
                        </span>
                        <span class="list-item-text">{{ task.get_task_name_display }}</span>
                    </div>
                    <div class="list-item-meta">
                        {% timezone "Europe/Madrid" %}{{ task.started_at|date:"H:i" }}{% endtimezone %}
                    </div>
                </div>
                {% empty %}
                <div class="admin-list-item">
                    <span class="list-item-text" style="color: #b0b0b0;">No recent executions</span>
                </div>
                {% endfor %}
            </div>
            <a href="{% url 'admin_task_executions' %}" class="section-link">View all executions ‚Üí</a>
        </div>
    </div>
</div>

<style>
.admin-dashboard {
    padding: 20px;
}

.admin-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.admin-stat-card {
    background: #252525;
    border: 1px solid #404040;
    border-radius: 8px;
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 15px;
    transition: transform 0.2s, box-shadow 0.2s;
    position: relative;
}

.admin-stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(196, 30, 58, 0.3);
    border-color: #c41e3a;
}

.stat-icon {
    font-size: 36px;
    line-height: 1;
}

.stat-content {
    flex: 1;
}

.stat-value {
    font-size: 28px;
    font-weight: 700;
    color: #c41e3a;
    line-height: 1.2;
}

.stat-label {
    font-size: 13px;
    color: #b0b0b0;
    margin-top: 4px;
}

.stat-link {
    color: #c41e3a;
    text-decoration: none;
    font-size: 12px;
    font-weight: 600;
    opacity: 0.7;
    transition: opacity 0.2s;
}

.stat-link:hover {
    opacity: 1;
}

.admin-sections-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 20px;
}

.admin-section-card {
    background: #252525;
    border: 1px solid #404040;
    border-radius: 8px;
    padding: 20px;
}

.admin-section-card h3 {
    color: #e0e0e0;
    font-size: 18px;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 2px solid #c41e3a;
}

.admin-list {
    margin-bottom: 15px;
}

.admin-list-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid #404040;
}

.admin-list-item:last-child {
    border-bottom: none;
}

.list-item-main {
    display: flex;
    align-items: center;
    gap: 10px;
    flex: 1;
}

.list-item-text {
    color: #e0e0e0;
    font-size: 14px;
}

.list-item-meta {
    color: #b0b0b0;
    font-size: 12px;
}

.section-link {
    display: inline-block;
    color: #c41e3a;
    text-decoration: none;
    font-size: 13px;
    font-weight: 600;
    margin-top: 10px;
}

.section-link:hover {
    text-decoration: underline;
}

.badge {
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
}

.badge-success {
    background: rgba(40, 167, 69, 0.2);
    color: #90ee90;
    border: 1px solid rgba(40, 167, 69, 0.4);
}

.badge-danger {
    background: rgba(220, 53, 69, 0.2);
    color: #ff6b6b;
    border: 1px solid rgba(220, 53, 69, 0.4);
}

.badge-warning {
    background: rgba(255, 193, 7, 0.2);
    color: #ffd700;
    border: 1px solid rgba(255, 193, 7, 0.4);
}

.badge-info {
    background: rgba(23, 162, 184, 0.2);
    color: #6bb6ff;
    border: 1px solid rgba(23, 162, 184, 0.4);
}

@media (max-width: 768px) {
    .admin-stats-grid {
        grid-template-columns: 1fr;
    }
    
    .admin-sections-grid {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}
