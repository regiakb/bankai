{% extends 'base.html' %}
{% load static %}

{% block title %}Configuration - BANKAI{% endblock %}

{% block page_title %}Configuration{% endblock %}

{% block content %}
<div class="admin-page">
    <div class="admin-header" style="margin-bottom: 24px;">
        <a href="{% url 'settings_index' %}" class="btn-back">‚Üê Back to Settings</a>
    </div>
    <div class="card" style="max-width: 800px; margin: 0 auto 30px;">
    <div style="text-align: center; margin-bottom: 30px;">
        <img src="{% static 'images/logo.png' %}" alt="BANKAI" style="max-width: 200px; margin-bottom: 20px;">
        <h2 style="color: #e0e0e0; margin-bottom: 10px;">Configuration</h2>
        <p style="color: #b0b0b0;">Configure your BANKAI network inventory system. To add multiple instances (e.g. 2 Proxmox node's), use <a href="{% url 'settings_index' %}#integrations" style="color: #c41e3a;">Settings ‚Üí Integrations</a>.</p>
    </div>

    {% if messages %}
        {% for message in messages %}
            <div class="message message-{{ message.tags }}" style="margin-bottom: 20px;">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <form method="post" action="{% url 'setup_wizard' %}">
        {% csrf_token %}
        
        <!-- System Configuration Section -->
        <div style="background: #252525; border: 1px solid #404040; border-radius: 8px; padding: 25px; margin-bottom: 25px;">
            <h3 style="color: #c41e3a; margin-bottom: 20px; border-bottom: 1px solid #404040; padding-bottom: 10px;">
                üîß System Configuration
            </h3>
            
            <div style="margin-bottom: 20px;">
                <label for="discovery_cidr" style="display: block; color: #e0e0e0; margin-bottom: 8px; font-weight: 500;">
                    Discovery Network CIDR
                </label>
                <input type="text" 
                       id="discovery_cidr" 
                       name="discovery_cidr" 
                       value="{{ discovery_cidr }}" 
                       placeholder="192.168.1.0/24"
                       required
                       style="width: 100%; padding: 12px; background: #1a1a1a; border: 1px solid #404040; border-radius: 4px; color: #e0e0e0; font-size: 14px;">
                <small style="color: #b0b0b0; font-size: 12px;">Network range to scan for hosts (e.g., 192.168.1.0/24)</small>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div>
                    <label for="discovery_interval" style="display: block; color: #e0e0e0; margin-bottom: 8px; font-weight: 500;">
                        Discovery Scan Interval (minutes)
                    </label>
                    <input type="number" 
                           id="discovery_interval" 
                           name="discovery_interval" 
                           value="{{ discovery_interval }}" 
                           min="1"
                           required
                           style="width: 100%; padding: 12px; background: #1a1a1a; border: 1px solid #404040; border-radius: 4px; color: #e0e0e0; font-size: 14px;">
                </div>
                
                <div>
                    <label for="service_scan_interval" style="display: block; color: #e0e0e0; margin-bottom: 8px; font-weight: 500;">
                        Service Scan Interval (minutes)
                    </label>
                    <input type="number" 
                           id="service_scan_interval" 
                           name="service_scan_interval" 
                           value="{{ service_scan_interval }}" 
                           min="1"
                           required
                           style="width: 100%; padding: 12px; background: #1a1a1a; border: 1px solid #404040; border-radius: 4px; color: #e0e0e0; font-size: 14px;">
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div>
                    <label for="proxmox_sync_interval" style="display: block; color: #e0e0e0; margin-bottom: 8px; font-weight: 500;">
                        Proxmox Sync Interval (minutes)
                    </label>
                    <input type="number" 
                           id="proxmox_sync_interval" 
                           name="proxmox_sync_interval" 
                           value="{{ proxmox_sync_interval }}" 
                           min="1"
                           required
                           style="width: 100%; padding: 12px; background: #1a1a1a; border: 1px solid #404040; border-radius: 4px; color: #e0e0e0; font-size: 14px;">
                </div>
                
                <div>
                    <label style="display: block; color: #e0e0e0; margin-bottom: 8px; font-weight: 500;">
                        Notify New IPs &amp; Services
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" 
                               id="notify_new_service" 
                               name="notify_new_service" 
                               {% if notify_new_service %}checked{% endif %}
                               style="width: 20px; height: 20px; cursor: pointer;">
                        <span style="color: #b0b0b0;">Send Telegram notifications for new IPs and new services</span>
                    </label>
                </div>
            </div>
        </div>

        <!-- Telegram Integration Section -->
        <div style="background: #252525; border: 1px solid #404040; border-radius: 8px; padding: 25px; margin-bottom: 25px;">
            <h3 style="color: #c41e3a; margin-bottom: 20px; border-bottom: 1px solid #404040; padding-bottom: 10px;">
                üì± Telegram Integration (Optional)
            </h3>
            
            <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px; cursor: pointer;">
                <input type="checkbox" 
                       id="telegram_enabled" 
                       name="telegram_enabled" 
                       {% if telegram_enabled %}checked{% endif %}
                       onchange="toggleTelegramFields()"
                       style="width: 20px; height: 20px; cursor: pointer;">
                <span style="color: #e0e0e0; font-weight: 500;">Enable Telegram notifications</span>
            </label>

            <div id="telegram_fields" style="{% if not telegram_enabled %}display: none;{% endif %}">
                <div style="margin-bottom: 15px;">
                    <label for="telegram_bot_token" style="display: block; color: #e0e0e0; margin-bottom: 8px; font-weight: 500;">
                        Bot Token
                    </label>
                    <input type="text" 
                           id="telegram_bot_token" 
                           name="telegram_bot_token" 
                           value="{{ telegram_bot_token }}" 
                           placeholder="123456789:ABCdefGHIjklMNOpqrsTUVwxyz"
                           style="width: 100%; padding: 12px; background: #1a1a1a; border: 1px solid #404040; border-radius: 4px; color: #e0e0e0; font-size: 14px;">
                    <small style="color: #b0b0b0; font-size: 12px;">Get this from @BotFather on Telegram</small>
                </div>

                <div>
                    <label for="telegram_chat_id" style="display: block; color: #e0e0e0; margin-bottom: 8px; font-weight: 500;">
                        Chat ID
                    </label>
                    <input type="text" 
                           id="telegram_chat_id" 
                           name="telegram_chat_id" 
                           value="{{ telegram_chat_id }}" 
                           placeholder="123456789"
                           style="width: 100%; padding: 12px; background: #1a1a1a; border: 1px solid #404040; border-radius: 4px; color: #e0e0e0; font-size: 14px;">
                    <small style="color: #b0b0b0; font-size: 12px;">Your Telegram chat ID or channel ID</small>
                </div>
            </div>
        </div>

        <!-- Proxmox Integration Section -->
        <div style="background: #252525; border: 1px solid #404040; border-radius: 8px; padding: 25px; margin-bottom: 25px;">
            <h3 style="color: #c41e3a; margin-bottom: 20px; border-bottom: 1px solid #404040; padding-bottom: 10px;">
                üñ•Ô∏è Proxmox Integration (Optional)
            </h3>
            
            <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px; cursor: pointer;">
                <input type="checkbox" 
                       id="proxmox_enabled" 
                       name="proxmox_enabled" 
                       {% if proxmox_enabled %}checked{% endif %}
                       onchange="toggleProxmoxFields()"
                       style="width: 20px; height: 20px; cursor: pointer;">
                <span style="color: #e0e0e0; font-weight: 500;">Enable Proxmox sync</span>
            </label>

            <div id="proxmox_fields" style="{% if not proxmox_enabled %}display: none;{% endif %}">
                <div style="margin-bottom: 15px;">
                    <label for="proxmox_url" style="display: block; color: #e0e0e0; margin-bottom: 8px; font-weight: 500;">
                        Proxmox URL
                    </label>
                    <input type="url" 
                           id="proxmox_url" 
                           name="proxmox_url" 
                           value="{{ proxmox_url }}" 
                           placeholder="https://proxmox.example.com:8006"
                           style="width: 100%; padding: 12px; background: #1a1a1a; border: 1px solid #404040; border-radius: 4px; color: #e0e0e0; font-size: 14px;">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label for="proxmox_token_id" style="display: block; color: #e0e0e0; margin-bottom: 8px; font-weight: 500;">
                            Token ID
                        </label>
                        <input type="text" 
                               id="proxmox_token_id" 
                               name="proxmox_token_id" 
                               value="{{ proxmox_token_id }}" 
                               placeholder="user@pam!token_name"
                               style="width: 100%; padding: 12px; background: #1a1a1a; border: 1px solid #404040; border-radius: 4px; color: #e0e0e0; font-size: 14px;">
                    </div>
                    
                    <div>
                        <label for="proxmox_token_secret" style="display: block; color: #e0e0e0; margin-bottom: 8px; font-weight: 500;">
                            Token Secret
                        </label>
                        <input type="password" 
                               id="proxmox_token_secret" 
                               name="proxmox_token_secret" 
                               value="{{ proxmox_token_secret }}" 
                               placeholder="Token secret"
                               style="width: 100%; padding: 12px; background: #1a1a1a; border: 1px solid #404040; border-radius: 4px; color: #e0e0e0; font-size: 14px;">
                    </div>
                </div>

                <div>
                    <label for="proxmox_node" style="display: block; color: #e0e0e0; margin-bottom: 8px; font-weight: 500;">
                        Node Name (Optional)
                    </label>
                    <input type="text" 
                           id="proxmox_node" 
                           name="proxmox_node" 
                           value="{{ proxmox_node }}" 
                           placeholder="pve"
                           style="width: 100%; padding: 12px; background: #1a1a1a; border: 1px solid #404040; border-radius: 4px; color: #e0e0e0; font-size: 14px;">
                    <small style="color: #b0b0b0; font-size: 12px;">Leave empty to sync all nodes</small>
                </div>
            </div>
        </div>

        <!-- AdGuard Home Integration Section -->
        <div style="background: #252525; border: 1px solid #404040; border-radius: 8px; padding: 25px; margin-bottom: 25px;">
            <h3 style="color: #c41e3a; margin-bottom: 20px; border-bottom: 1px solid #404040; padding-bottom: 10px;">
                üõ°Ô∏è AdGuard Home Integration (Optional)
            </h3>
            
            <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px; cursor: pointer;">
                <input type="checkbox" 
                       id="adguard_enabled" 
                       name="adguard_enabled" 
                       {% if adguard_enabled %}checked{% endif %}
                       onchange="toggleAdguardFields()"
                       style="width: 20px; height: 20px; cursor: pointer;">
                <span style="color: #e0e0e0; font-weight: 500;">Enable AdGuard Home sync</span>
            </label>

            <div id="adguard_fields" style="{% if not adguard_enabled %}display: none;{% endif %}">
                <div style="margin-bottom: 15px;">
                    <label for="adguard_url" style="display: block; color: #e0e0e0; margin-bottom: 8px; font-weight: 500;">
                        AdGuard Home URL
                    </label>
                    <input type="url" 
                           id="adguard_url" 
                           name="adguard_url" 
                           value="{{ adguard_url }}" 
                           placeholder="http://adguard.example.com:80"
                           style="width: 100%; padding: 12px; background: #1a1a1a; border: 1px solid #404040; border-radius: 4px; color: #e0e0e0; font-size: 14px;">
                    <small style="color: #b0b0b0; font-size: 12px;">Full URL to your AdGuard Home instance (including port)</small>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label for="adguard_username" style="display: block; color: #e0e0e0; margin-bottom: 8px; font-weight: 500;">
                            Username
                        </label>
                        <input type="text" 
                               id="adguard_username" 
                               name="adguard_username" 
                               value="{{ adguard_username }}" 
                               placeholder="AdGuard admin username"
                               style="width: 100%; padding: 12px; background: #1a1a1a; border: 1px solid #404040; border-radius: 4px; color: #e0e0e0; font-size: 14px;">
                    </div>
                    
                    <div>
                        <label for="adguard_password" style="display: block; color: #e0e0e0; margin-bottom: 8px; font-weight: 500;">
                            Password
                        </label>
                        <input type="password" 
                               id="adguard_password" 
                               name="adguard_password" 
                               value="{{ adguard_password }}" 
                               placeholder="AdGuard admin password"
                               style="width: 100%; padding: 12px; background: #1a1a1a; border: 1px solid #404040; border-radius: 4px; color: #e0e0e0; font-size: 14px;">
                    </div>
                </div>
            </div>
        </div>

        <!-- Submit Button -->
        <div style="text-align: center; margin-top: 30px;">
            <button type="submit" 
                    class="btn" 
                    style="background: #c41e3a; color: #fff; padding: 15px 40px; font-size: 16px; font-weight: 600; border: none; border-radius: 4px; cursor: pointer; transition: background 0.3s;">
                Complete Setup
            </button>
        </div>
    </form>
</div>
</div>

<script>
function toggleTelegramFields() {
    const checkbox = document.getElementById('telegram_enabled');
    const fields = document.getElementById('telegram_fields');
    fields.style.display = checkbox.checked ? 'block' : 'none';
}

function toggleProxmoxFields() {
    const checkbox = document.getElementById('proxmox_enabled');
    const fields = document.getElementById('proxmox_fields');
    fields.style.display = checkbox.checked ? 'block' : 'none';
}

function toggleAdguardFields() {
    const checkbox = document.getElementById('adguard_enabled');
    const fields = document.getElementById('adguard_fields');
    fields.style.display = checkbox.checked ? 'block' : 'none';
}
</script>
{% endblock %}
